<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>酒店专业定价决策系统 v6.0</title>
    <style>
        :root { --primary: #007aff; --success: #34c759; --danger: #ff3b30; --bg: #f2f2f7; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); padding: 10px; font-size: 14px; color: #1c1c1e; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 25px; border-radius: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        
        /* 布局卡片 */
        .header-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-bottom: 20px; background: #f9f9f9; padding: 15px; border-radius: 12px; }
        .section-title { font-size: 16px; font-weight: 700; margin: 25px 0 10px; padding-left: 10px; border-left: 4px solid var(--primary); display: flex; justify-content: space-between; align-items: center; }

        /* 竞对样式 */
        .comp-list { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 12px; }
        .comp-card { border: 1px solid #eee; padding: 15px; border-radius: 12px; position: relative; background: #fff; }
        .comp-inputs { display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 10px; }
        
        /* 房型样式 */
        .room-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        .room-table th { background: #f9f9f9; padding: 10px; text-align: left; font-size: 12px; color: #8e8e93; }
        .room-table td { padding: 12px 10px; border-bottom: 1px solid #eee; }
        
        input, select { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 14px; }
        
        /* 按钮样式 */
        .btn-add { background: var(--primary); color: white; border: none; padding: 6px 12px; border-radius: 8px; cursor: pointer; font-size: 13px; }
        .btn-del { color: var(--danger); background: none; border: none; font-size: 18px; cursor: pointer; }
        .nudge-group { display: flex; align-items: center; gap: 5px; }
        .btn-nudge { border: 1px solid #ddd; background: #fff; border-radius: 4px; padding: 2px 8px; cursor: pointer; }

        #calculate-btn { width: 100%; padding: 16px; background: var(--primary); color: white; border: none; border-radius: 14px; font-size: 18px; font-weight: bold; margin: 30px 0; cursor: pointer; box-shadow: 0 4px 12px rgba(0,122,255,0.3); }
        
        /* 结果展示 */
        .result-card { padding: 15px; background: #f8f9ff; border: 1px solid #e0e7ff; border-radius: 12px; margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center; }
        .tag { font-size: 12px; padding: 3px 8px; border-radius: 6px; font-weight: bold; margin-left: 8px; }
        .tag-up { background: #ffebeb; color: var(--danger); }
        .tag-down { background: #e8f5e9; color: var(--success); }
    </style>
</head>
<body>

<div class="container">
    <h2 style="text-align:center;">酒店定价决策系统 v6.0</h2>

    <!-- 1. 基础环境设置 -->
    <div class="header-grid">
        <div><label>酒店定位</label><select id="hotelType"><option value="business">商务型</option><option value="resort">度假型</option></select></div>
        <div><label>时间节点</label><select id="weekDay"><option value="weekday">工作日</option><option value="weekend">周五周六</option><option value="sunday">周日晚</option></select></div>
        <div><label>当前总OCC (%)</label><input type="number" id="occ" value="55"></div>
        <div><label>市场策略</label><select id="marketPosition"><option value="1.05">领先者(+5%)</option><option value="1.0" selected>对标跟随</option><option value="0.9">渗透抢单(-10%)</option></select></div>
    </div>

    <!-- 2. 竞争对手模块 (动态增减) -->
    <div class="section-title">
        竞争对手调研
        <button class="btn-add" onclick="addComp()">+ 增加竞对</button>
    </div>
    <div id="comp-list" class="comp-list">
        <!-- 默认加载两个竞对 -->
    </div>

    <!-- 3. 我方房型模块 (动态增减) -->
    <div class="section-title">
        我方房型定价
        <button class="btn-add" onclick="addRoom()">+ 增加房型</button>
    </div>
    <table class="room-table">
        <thead>
            <tr><th>房型名称</th><th>当前价</th><th>手动微调</th><th>战略</th><th>操作</th></tr>
        </thead>
        <tbody id="room-body">
            <!-- 默认加载一个房型 -->
        </tbody>
    </table>

    <button id="calculate-btn" onclick="runAnalysis()">生成今日调价建议</button>

    <!-- 4. 输出区域 -->
    <div id="output-area" style="display:none;">
        <div class="section-title">调价方案反馈</div>
        <div id="results-container"></div>
    </div>
</div>

<script>
    // --- 动态添加竞对逻辑 ---
    function addComp(name = "新竞对酒店", price = "", soldOut = 0) {
        const container = document.getElementById('comp-list');
        const html = `
            <div class="comp-card">
                <div class="comp-inputs">
                    <div><label>酒店名</label><input type="text" class="comp-name" value="${name}"></div>
                    <div><label>最低价</label><input type="number" class="comp-p" value="${price}"></div>
                    <div><label>满房数</label><input type="number" class="comp-s" value="${soldOut}"></div>
                </div>
                <button class="btn-del" onclick="this.parentElement.remove()" style="position:absolute; top:5px; right:5px;">✕</button>
            </div>`;
        container.insertAdjacentHTML('beforeend', html);
    }

    // --- 动态添加房型逻辑 ---
    function addRoom(name = "高级大床房", price = 300, type = "profit") {
        const container = document.getElementById('room-body');
        const html = `
            <tr class="room-row">
                <td><input type="text" class="r-name" value="${name}"></td>
                <td><input type="number" class="r-curr" value="${price}"></td>
                <td>
                    <div class="nudge-group">
                        <button class="btn-nudge" onclick="nudge(this,-2)">-</button>
                        <span class="nudge-val">0</span>%
                        <button class="btn-nudge" onclick="nudge(this,2)">+</button>
                    </div>
                </td>
                <td>
                    <select class="r-type">
                        <option value="profit" ${type==='profit'?'selected':''}>利润</option>
                        <option value="traffic" ${type==='traffic'?'selected':''}>引流</option>
                    </select>
                </td>
                <td><button class="btn-del" onclick="this.parentElement.parentElement.remove()">✕</button></td>
            </tr>`;
        container.insertAdjacentHTML('beforeend', html);
    }

    function nudge(btn, delta) {
        const span = btn.parentElement.querySelector('.nudge-val');
        span.innerText = parseInt(span.innerText) + delta;
    }

    // --- 核心计算分析 ---
    function runAnalysis() {
        const hotelType = document.getElementById('hotelType').value;
        const weekDay = document.getElementById('weekDay').value;
        const occ = parseFloat(document.getElementById('occ').value) || 0;
        const position = parseFloat(document.getElementById('marketPosition').value);

        // 1. 时间基础权重逻辑
        let timeWeight = 1.0;
        if(hotelType === 'business') {
            timeWeight = (weekDay === 'weekday') ? 1.15 : (weekDay === 'sunday' ? 0.8 : 0.9);
        } else {
            timeWeight = (weekDay === 'weekend') ? 1.35 : 0.8;
        }

        // 2. 竞对多维数据汇总
        const compPriceElements = document.querySelectorAll('.comp-p');
        const compSoldElements = document.querySelectorAll('.comp-s');
        let totalP = 0, validCompCount = 0, totalSoldOuts = 0;

        compPriceElements.forEach((el, i) => {
            const p = parseFloat(el.value);
            if(p) { totalP += p; validCompCount++; }
            totalSoldOuts += parseFloat(compSoldElements[i].value || 0);
        });
        const marketAvg = validCompCount > 0 ? totalP / validCompCount : 0;

        // 3. 房型循环计算建议价格
        let resultHtml = '';
        document.querySelectorAll('.room-row').forEach(row => {
            const rName = row.querySelector('.r-name').value;
            const rCurr = parseFloat(row.querySelector('.r-curr').value);
            const rNud = parseFloat(row.querySelector('.nudge-val').innerText) / 100;
            const rType = row.querySelector('.r-type').value;

            // 算法公式: 调价比例 = (时间影响 + 出租率压力 + 市场供需奖励 + 投资人主观微调)
            const occImpact = (occ - 55) / 200; // 每超出55%水位10个点，建议提价5%
            const marketScarcity = totalSoldOuts * 0.035; // 市场每多一个满房房型，由于竞争变小，建议涨价3.5%
            
            let suggestedAdjustment = (timeWeight - 1) + occImpact + marketScarcity + rNud;
            
            // 最终建议价 = 当前价 * 建议比例 * 市场地位系数
            let targetPrice = (rCurr * (1 + suggestedAdjustment)) * position;

            // 引流房对冲逻辑 (不让引流房涨跌太猛，维持OTA流量稳定)
            if(rType === 'traffic') {
                targetPrice = (targetPrice + rCurr * 2) / 3;
            }

            // 价格美化：逢5取整
            targetPrice = Math.round(targetPrice / 5) * 5;

            const diff = ((targetPrice - rCurr) / rCurr * 100).toFixed(1);
            const statusClass = diff >= 0 ? 'tag-up' : 'tag-down';

            resultHtml += `
                <div class="result-card">
                    <div>
                        <b style="font-size:16px;">${rName}</b>
                        <span class="tag ${statusClass}">${diff >= 0 ? '↑' : '↓'} ${Math.abs(diff)}%</span>
                    </div>
                    <div style="text-align:right;">
                        <div style="color:#888; font-size:12px;">建议调整至</div>
                        <div style="font-size:22px; font-weight:bold; color:var(--primary);">￥${targetPrice}</div>
                    </div>
                </div>`;
        });

        document.getElementById('results-container').innerHTML = resultHtml;
        document.getElementById('output-area').style.display = 'block';
    }

    // 初始化：默认增加3个竞对和2个房型
    window.onload = () => {
        addComp("竞对酒店 A", "", 0);
        addComp("竞对酒店 B", "", 1);
        addComp("竞对酒店 C", "", 0);
        addRoom("引流大床房", 260, "traffic");
        addRoom("高级双床房", 380, "profit");
    };
</script>

</body>
</html>